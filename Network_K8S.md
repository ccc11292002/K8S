Network
============================

## Kubernetes(K8s)

`Rev: 1.0.0`

---

## When to use ?

  - Load Balance
    - AWS EC2 Price
      - 在AWS上的各種硬體配備，有其對應的價格
    - JMeter
      - 軟體來進行壓力測試
  - NAT
    - NAT (網絡地址轉換) 技術在平時是很多見的，如家庭中在使用路由器共享上網時，一般用的就是NAT 技術，它可以實現眾多內網IP 共享一個公網IP 上網。
    - NAT 的原理簡單的說就是當內網主機訪問外網時，當內網主機的數據包要通過路由器時，路由器將數據包中的源內網IP 地址改為路由器上的公網IP 地址，同時記錄下該數據包的消息
    - 當外網服務器響應這次由內而外發出的請求或數據交換時，當外網服務器發出的數據包經過路由器時，原本是路由器上的公網IP 地址被路由器改為內網IP 。 
  - SNAT
    - 如果內網主機訪問外網而經過路由時，源IP會發生改變，這種變更行為就是SNAT
  - DNAT 
    - 當外網的數據經過路由發往內網主機時，數據包中的目的IP (路由器上的公網IP)將修改為內網IP，這種變更行為就是DNAT
  - postrouting
    - 一般指的是發往公網的數據包
    - 外網到內網是post
    - 每個網卡數據流出的時候必然經過post
    - POSTROUTING是源地址轉換，要把你的內網地址轉換成公網地址才能讓你上網。
    - 在執行S NAT任務時的行為規則就添加在POSTROUTING鏈中
  - prerouting
    - 一般指來自公網的數據包
    - 內網到外網是pre
    - 每個網卡數據流入的時候必然經過pre
    - 要把別人的公網IP換成你們內部的IP，才讓訪問到你們內部受防火牆保護的機器。
    - 當外網的數據包進入到內網時，我們需要修改數據包中的公網IP為內網的主機IP，這種D NAT的行為規則就要在PREROUTING鏈裡添加
    
---

## History

  - goole 10年容器化基礎架購。brog管理資源框架與容器 -> go語言成形便K8S

---

## Advantage

  - 輕量級:消耗資源少
  - go語言->編譯型語言，如C語言支持進程管理
  - 開源
  - 彈性伸縮->伸增加節點 縮減少節點 彈性:平緩升級，不須重啟服務，改配置
  - 負載均衡
    - IPVS，是運行在LVS下的提供負載平衡功能的一種技術 
     - LVS 
       - Linux Virtual Server，虛擬服務器是一個高度可擴展性和高可用性的服務器

---

## Description

  - SNAT

    - vm(client)--->SNAT(將數據包中的內網源IP轉換為外網IP)--->Internet(服務器）--->SNAT(將數據包內的目的IP轉換為內網IP)--->vm(client)
  - DNAT

    - Internet(client用戶)--->DNAT(將數據包中的目的公網IP轉換為目的內網IP)--->VM(server)--->DNAT(將數據包中的源內網IP轉換為外網IP)--->Internet(client用戶)
  - 回滾 
    - 當升級完後同事發現此次的升級造成服務發生不穩定的狀況，但他們不見得清楚先前的設定檔的樣子。在這種狀況下，我們可以利用 rollback 來回復到先前的狀態。
  - Rolling update
    - 就是指一次僅更新一個Pod，並逐個進行更新，而不是在同一時刻將該Service下面的所有Pod shutdown
    - 滾動更新就是針對多實例服務的一種不中斷服務的更新升級方式。一般情況，對於多實例服務，滾動更新采用對各個實例逐個進行單獨更新而非同一時刻對所有實例進行全部更新的方式
  - MESOS
    - Apache資源管理框架， 分布式管理系統框架，推特的基礎平台->後來改為K8S
    - 可以平台可以管理K8S，多一個框架管理有出錯風險
  - docker SWARM
    - 已經在docker組件裡，功能相對K8S還是太少->少回滾跟滾動更新
    - 實現架構好，效率好
    - 被阿里雲踢出
  - Pod
    - 最小的封裝集合 
  - IPVS
    - 運行在LVS下的提供負載平衡功能的一種技術 
  - LAMP
    - Linux，作業系統
    - Apache，網頁伺服器
    - MariaDB或MySQL，資料庫管理系統（或者資料庫伺服器）
    - PHP、Perl或Python，手稿語言

---

## 組件

  - 高可用集群副本數據最好是 >= 3
  - api server
    - 所有服務訪問統一入口 
  - CrontrollerManger
    - 維持副本期望數目
  - Scheduler
    - 負責接收任務，選擇合適的節點進行分配任務
  - ETCD
    - 鍵值對數據庫 儲存K8S集群所有重要訊息(持久化)
  - Kubelet
    - 直接跟容器引擎交互實現容器的生命週期管理
  - Kube-proxy
    - 負責寫入規則至IPTABLES、IPVS實現服務映射訪問的
  - COREDNS
    - 可以為集群中的SVC創建一個域名IP的對應關係解析
  - DASHBOARD
    - 給K8S集群提供一個B/S結構訪問體系
  - Ingress Controller
    - 官方只能實現四層代理，ingress可以實現七層代理
  - FEDETATION
    - 提供一個可以跨集群中心多K8S統一管理功能
  - PROMETHEUS
    - 提供K8S集群的監控能力
  - ELK
    - 提供K8S集群日誌統一分析介入平台               

---

## Process

  - 介紹說明:前世今生 K8S框架 關鍵字含義 
  - 基礎概念: 什麼是Pod 控制器類型 K8S 網路通訊模式
  - K8S建構 K8S集群
  - 資源清單: 資源 掌握資源清單的語法 編寫Pod 掌握Pod的生命週期
  - Pod控制器: 掌握各種控制器的特點以及使用定義方式
  - 服務發現: 掌握SVC原理及其建構方式
  - 服務分類: 
    - 有狀態服務: DBMS
      - 要实现一种计数服务，每次请求都要对之前请求处理的数据结果进行+1 的操作，这就需要在服务端存储维护计数的数据，这样的服务就属于有状态的服务
      - Web 应用中，经常会使用Session 来维系登录用户的上下文信息。虽然http 协议是无状态的，但是借助于Cookie 和Session，可以使http 服务转换为有状态服务
    - 無狀態服務: LVS、APACHE
      - 無狀態服務對於客戶端的單次請求的處理，不依賴於其他請求，處理一次請求的信息都包含在該請求里。典型的無狀態服務的例子就是http 協議
      - 要實現一個計算求和的服務，每次請求都將求和的兩個值傳送給服務端，然後服務端計算求和結果，並返回給客戶端，服務端不保存任何信息，這樣的服務就屬於無狀態服務
  - 存儲
    - 掌握多種存儲類型的特點，並能夠在不同環境中選擇合適的存儲方案(有自己的見解)
  - 調度器
    - 掌握調度器原理 能夠根據要求打Pod定義到想要的節點運行
  - 安全
    - 集群的認證 鑿權 訪問控制 原理及流程 
  - HELM
    - Linux yum 掌握 HELM 原理 HELM模板自定義 HELM部屬一些常用插件
  - 運維
    - 修改Kubeadm達到證書可用期限為10年 能夠購艦高可用的K8S 集群

---

## Associates

  - **Editor**
    - Lee.DavidC.E.
